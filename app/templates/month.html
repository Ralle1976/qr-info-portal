{% extends "base.html" %}

{% block title %}{{ t('month') }} - {{ super() }}{% endblock %}

{% block content %}
<div class="bg-white rounded-lg shadow-md p-6">
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-bold text-thai-turquoise">
            {{ t('month') }} - {{ month }}/{{ year }}
        </h2>
        
        <!-- Month Navigation -->
        <div class="flex space-x-2">
            <a href="{{ url_for('public.month_view', year=prev_year, month=prev_month) }}" 
               class="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded transition">
                &larr;
            </a>
            <a href="{{ url_for('public.month_view') }}" 
               class="px-3 py-1 bg-thai-turquoise text-white rounded hover:bg-cyan-600 transition">
                {{ t('today') }}
            </a>
            <a href="{{ url_for('public.month_view', year=next_year, month=next_month) }}" 
               class="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded transition">
                &rarr;
            </a>
        </div>
    </div>
    
    <!-- Calendar Grid -->
    <div class="grid grid-cols-7 gap-1">
        <!-- Day Headers -->
        {% set day_names_short = ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'] %}
        {% for day_name in day_names_short %}
            <div class="text-center font-semibold text-gray-600 py-2">{{ day_name }}</div>
        {% endfor %}
        
        <!-- Empty cells for first week -->
        {% set first_day = month_schedule[0].date if month_schedule else None %}
        {% if first_day %}
            {% for i in range(first_day.weekday()) %}
                <div class="p-2"></div>
            {% endfor %}
        {% endif %}
        
        <!-- Calendar Days -->
        {% for day_info in month_schedule %}
            {% set is_today = day_info.date == today %}
            {% set is_weekend = day_info.date.weekday() >= 5 %}
            <div class="border rounded p-2 min-h-[80px] {% if is_today %}border-thai-turquoise bg-thai-turquoise/10{% elif is_weekend %}bg-gray-50{% endif %}">
                <div class="text-sm font-semibold {% if is_today %}text-thai-turquoise{% endif %}">
                    {{ day_info.date.day }}
                </div>
                
                {% if day_info.closed %}
                    <div class="text-xs text-red-600 mt-1">{{ t('closed') }}</div>
                {% else %}
                    {% for time_range in day_info.time_ranges[:1] %}
                        <div class="text-xs text-gray-600 mt-1">{{ time_range }}</div>
                    {% endfor %}
                    {% if day_info.time_ranges|length > 1 %}
                        <div class="text-xs text-gray-500">...</div>
                    {% endif %}
                {% endif %}
                
                {% if day_info.is_exception %}
                    <div class="w-2 h-2 bg-amber-400 rounded-full mt-1"></div>
                {% endif %}
            </div>
        {% endfor %}
    </div>
    
    <!-- Legend -->
    <div class="mt-6 flex flex-wrap gap-4 text-sm">
        <div class="flex items-center">
            <div class="w-4 h-4 bg-thai-turquoise/10 border border-thai-turquoise rounded mr-2"></div>
            <span>{{ t('today') }}</span>
        </div>
        <div class="flex items-center">
            <div class="w-2 h-2 bg-amber-400 rounded-full mr-2"></div>
            <span>Ausnahme</span>
        </div>
        <div class="flex items-center">
            <div class="w-4 h-4 bg-gray-50 border rounded mr-2"></div>
            <span>Wochenende</span>
        </div>
    </div>
</div>

<!-- Status Info -->
{% if status and status.type != 'ANWESEND' %}
<div class="mt-6 bg-yellow-100 border-l-4 border-yellow-400 p-4 rounded-r">
    <p class="font-semibold text-yellow-700">
        {{ t('status') }}: 
        {% if status.type == 'URLAUB' %}
            {{ t('on_vacation') }}
        {% elif status.type == 'BILDUNGSURLAUB' %}
            {{ t('educational_leave') }}
        {% elif status.type == 'KONGRESS' %}
            {{ t('congress') }}
        {% else %}
            {{ t('other') }}
        {% endif %}
    </p>
    {% if status.next_return %}
        <p class="text-sm mt-1">{{ t('back_on') }}: {{ status.next_return.strftime('%d.%m.%Y') }}</p>
    {% endif %}
</div>
{% endif %}
{% endblock %}